{% extends "base.html" %}
{% load static %}

{% block title %}{{ assignment.title }} | ê³¼ì œ{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/assignment_detail.css' %}">
{% endblock %}

{% block content %}
<main class="card-wrap detail-wrap">
  <div class="card-inner">

    <article class="detail-inner">

      <div class="asg-title-section">
        <h1 class="asg-title">
          ğŸ“ {{ assignment.title }}
        </h1>
        <p class="asg-course-name">
          {{ assignment.course.title }}
        </p>
      </div>

      <section class="asg-meta-box">
        <div class="asg-meta-grid">
          <div>
            <span class="meta-label">ë§ˆê°ì¼:</span>
            <strong class="meta-value {% if assignment.is_overdue %}overdue{% endif %}">
              {{ assignment.due_date|date:"Yë…„ mì›” dì¼ H:i" }}
            </strong>
            {% if assignment.is_overdue %}
            <span class="badge-overdue">â° ë§ˆê° ì§€ë‚¨</span>
            {% endif %}
          </div>
          <div>
            <span class="meta-label">ë°°ì :</span>
            <strong class="meta-value">{{ assignment.max_score }}ì </strong>
          </div>
          <div>
            <span class="meta-label">ë“±ë¡ì¼:</span>
            <strong class="meta-value">{{ assignment.created_at|date:"Y-m-d" }}</strong>
          </div>
        </div>
      </section>

      {% if assignment.attachment %}
      <section class="detail-section">
        <h2 class="section-title">ğŸ“ ì²¨ë¶€ íŒŒì¼</h2>
        <div class="file-box">
          <a href="{{ assignment.attachment.url }}" target="_blank" class="file-link">
            {{ assignment.attachment.name }}
          </a>
        </div>
      </section>
      {% endif %}

      <section>
        <h2 class="section-title-lg">ğŸ“‹ ê³¼ì œ ë‚´ìš©</h2>
        <div class="content-box">
          {{ assignment.description }}
        </div>
      </section>

      <section class="submission-status-card {% if submission %}submitted{% endif %}">
        <h2 class="section-title-lg">
          {% if submission %}âœ… ì œì¶œ ì™„ë£Œ{% else %}â³ ë¯¸ì œì¶œ{% endif %}
        </h2>

        {% if submission %}
        <div class="submission-info-box">
          <p class="sub-info-row">
            <strong>ì œì¶œ ì‹œê°„:</strong> {{ submission.submitted_at|date:"Y-m-d H:i" }}
            {% if submission.is_late %}
            <span class="badge-late">â° ì§€ê° ì œì¶œ</span>
            {% endif %}
          </p>

          {% if submission.file %}
          <p class="sub-info-row">
            <strong>ì œì¶œ íŒŒì¼:</strong>
            <a href="{{ submission.file.url }}" target="_blank" class="file-link">
              {{ submission.file.name|slice:"20" }}
            </a>
          </p>
          {% endif %}

          {% if submission.score %}
          <p class="sub-info-row">
            <strong>ì ìˆ˜:</strong>
            <span class="score-text">{{ submission.score }}ì </span>
            / {{ assignment.max_score }}ì 
          </p>
          {% endif %}

          {% if submission.feedback %}
          <div class="feedback-box">
            <strong>ê°•ì‚¬ í”¼ë“œë°±:</strong>
            <p class="feedback-content">{{ submission.feedback }}</p>
          </div>
          {% endif %}
        </div>

        {% if request.user != assignment.course.instructor and request.user.role != 'manager' %}
        <a href="{% url 'classroom:submit_assignment' assignment.assignment_id %}" class="btn-resubmit">
          ğŸ“ ì¬ì œì¶œí•˜ê¸°
        </a>
        {% endif %}

        {% else %}
        <p class="no-submit-msg">ì•„ì§ ê³¼ì œë¥¼ ì œì¶œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
        {% if request.user != assignment.course.instructor and request.user.role != 'manager' %}
        <a href="{% url 'classroom:submit_assignment' assignment.assignment_id %}" class="btn-submit">
          ğŸ“¤ ê³¼ì œ ì œì¶œí•˜ê¸°
        </a>
        {% endif %}
        {% endif %}
      </section>

      <div class="detail-footer">
        <a href="{% url 'classroom:my_course_detail' assignment.course.course_id %}" class="btn-list">
          â† ê°•ì˜ì‹¤ë¡œ
        </a>

        {% if request.user == assignment.course.instructor or request.user.role == 'manager' %}
        <div class="admin-actions">
          <a href="{% url 'classroom:assignment_update' assignment.assignment_id %}" class="btn-mini-edit">
            âœï¸ ê³¼ì œ ìˆ˜ì •
          </a>
          <a href="{% url 'classroom:assignment_delete' assignment.assignment_id %}" class="btn-mini-delete">
            ğŸ—‘ ê³¼ì œ ì‚­ì œ
          </a>
        </div>
        {% endif %}
      </div>

    </article>

  </div>
</main>
{% endblock %}