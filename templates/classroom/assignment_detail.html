{% extends "base.html" %}
{% load static %}

{% block title %}{{ assignment.title }} | ê³¼ì œ{% endblock %}

{% block content %}
<main class="card-wrap" style="padding-top: 60px; padding-bottom: 60px;">
  <div class="card-inner">

    <article style="max-width: 900px; margin: 0 auto;">

      <div style="margin-bottom: 30px;">
        <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
          ğŸ“ {{ assignment.title }}
        </h1>
        <p style="font-size: 16px; color: #666; font-weight: 500;">
          {{ assignment.course.title }}
        </p>
      </div>

      <section style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
        <div style="display: flex; flex-wrap: wrap; gap: 20px; font-size: 14px;">
          <div>
            <span style="color: #6c757d;">ë§ˆê°ì¼:</span>
            <strong style="color: {% if assignment.is_overdue %}#dc3545{% else %}#212529{% endif %};">
              {{ assignment.due_date|date:"Yë…„ mì›” dì¼ H:i" }}
            </strong>
            {% if assignment.is_overdue %}
            <span style="color: #dc3545; font-weight: 600; margin-left: 10px;">â° ë§ˆê° ì§€ë‚¨</span>
            {% endif %}
          </div>
          <div>
            <span style="color: #6c757d;">ë°°ì :</span>
            <strong>{{ assignment.max_score }}ì </strong>
          </div>
          <div>
            <span style="color: #6c757d;">ë“±ë¡ì¼:</span>
            <strong>{{ assignment.created_at|date:"Y-m-d" }}</strong>
          </div>
        </div>
      </section>

      {% if assignment.attachment %}
      <section style="margin-bottom: 30px;">
        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 10px;">ğŸ“ ì²¨ë¶€ íŒŒì¼</h2>
        <div style="padding: 15px; border-radius: 8px; border: 1px solid #dee2e6; background:#f8f9fa;">
          <a href="{{ assignment.attachment.url }}" target="_blank" style="color:#0d6efd;">
            {{ assignment.attachment.name }}
          </a>
        </div>
      </section>
      {% endif %}

      <section style="margin-bottom: 40px;">
        <h2 style="font-size: 20px; font-weight: 600; margin-bottom: 15px;">ğŸ“‹ ê³¼ì œ ë‚´ìš©</h2>
        <div style="line-height: 1.8; white-space: pre-wrap; padding: 20px; background-color: #fff; border: 1px solid #dee2e6; border-radius: 8px;">
          {{ assignment.description }}
        </div>
      </section>

      <section style="border: 2px solid {% if submission %}#28a745{% else %}#ffc107{% endif %}; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
        <h2 style="font-size: 20px; font-weight: 600; margin-bottom: 15px;">
          {% if submission %}
          âœ… ì œì¶œ ì™„ë£Œ
          {% else %}
          â³ ë¯¸ì œì¶œ
          {% endif %}
        </h2>

        {% if submission %}
        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
          <p style="margin-bottom: 10px;">
            <strong>ì œì¶œ ì‹œê°„:</strong> {{ submission.submitted_at|date:"Y-m-d H:i" }}
            {% if submission.is_late %}
            <span style="color: #dc3545; margin-left: 10px;">â° ì§€ê° ì œì¶œ</span>
            {% endif %}
          </p>

          {% if submission.file %}
          <p style="margin-bottom: 10px;">
            <strong>ì œì¶œ íŒŒì¼:</strong>
            <a href="{{ submission.file.url }}" target="_blank" style="color:#0d6efd;">
              {{ submission.file.name|slice:"20" }}
            </a>
          </p>
          {% endif %}

          {% if submission.score %}
          <p style="margin-bottom: 10px;">
            <strong>ì ìˆ˜:</strong>
            <span style="color: #28a745; font-size: 18px; font-weight: 600;">
              {{ submission.score }}ì 
            </span>
            / {{ assignment.max_score }}ì 
          </p>
          {% endif %}

          {% if submission.feedback %}
          <div style="margin-top: 15px; padding: 15px; background-color: #fff; border-left: 4px solid #0d6efd;">
            <strong>ê°•ì‚¬ í”¼ë“œë°±:</strong>
            <p style="margin-top: 10px; white-space: pre-wrap;">{{ submission.feedback }}</p>
          </div>
          {% endif %}
        </div>

        {% if request.user != assignment.course.instructor and request.user.role != 'manager' %}
        <a href="{% url 'classroom:submit_assignment' assignment.assignment_id %}" style="display: inline-block; padding: 10px 20px; background-color: #0d6efd; color: white; text-decoration: none; border-radius: 5px;">
          ğŸ“ ì¬ì œì¶œí•˜ê¸°
        </a>
        {% endif %}
        {% else %}
        <p style="color: #6c757d; margin-bottom: 15px;">ì•„ì§ ê³¼ì œë¥¼ ì œì¶œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
        {% if request.user != assignment.course.instructor and request.user.role != 'manager' %}
        <a href="{% url 'classroom:submit_assignment' assignment.assignment_id %}" style="display: inline-block; padding: 10px 20px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px;">
          ğŸ“¤ ê³¼ì œ ì œì¶œí•˜ê¸°
        </a>
        {% endif %}
        {% endif %}
      </section>

      <div style="padding-top: 20px; border-top: 1px solid #dee2e6; display:flex; justify-content:space-between; align-items:center;">
        <a href="{% url 'classroom:my_course_detail' assignment.course.course_id %}"
           style="display: inline-block; padding: 10px 20px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 5px;">
          â† ê°•ì˜ì‹¤ë¡œ
        </a>

        {% if request.user == assignment.course.instructor or request.user.role == 'manager' %}
        <div style="display:flex; gap:8px;">
          <a href="{% url 'classroom:assignment_update' assignment.assignment_id %}"
             style="padding:8px 14px; background:#0d6efd; color:white; text-decoration:none; border-radius:5px; font-size:13px;">
            âœï¸ ê³¼ì œ ìˆ˜ì •
          </a>
          <a href="{% url 'classroom:assignment_delete' assignment.assignment_id %}"
             style="padding:8px 14px; background:#dc3545; color:white; text-decoration:none; border-radius:5px; font-size:13px;">
            ğŸ—‘ ê³¼ì œ ì‚­ì œ
          </a>
        </div>
        {% endif %}
      </div>

    </article>

  </div>
</main>
{% endblock %}