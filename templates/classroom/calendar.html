{% extends "base.html" %}
{% load static %}

{% block title %}ìº˜ë¦°ë” | ë‚´ ê°•ì˜ì‹¤{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/calendar.css' %}">
{% endblock %}

{% block content %}
<div class="classroom-wrapper">
  <div class="classroom-container">

    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="avatar">ğŸ‘¤</div>
        <h2>{{ request.user.name }}</h2>
        <span class="user-role">
          {% if request.user.role == 'manager' %}ğŸ‘‘ ê´€ë¦¬ì
          {% elif request.user.role == 'instructor' %}ğŸ‘¨â€ğŸ« ê°•ì‚¬
          {% else %}ğŸ“ í•™ìƒ{% endif %}
        </span>
      </div>

      <ul class="sidebar-menu">
        <li><a href="{% url 'classroom:my_classroom' %}">ğŸ“Š ëŒ€ì‹œë³´ë“œ</a></li>
        <li><a href="{% url 'classroom:calendar' %}" class="active">ğŸ“… ìº˜ë¦°ë”</a></li>
      </ul>

      <div class="my-courses-section">
          <div class="section-title">ğŸ“š ë‚´ ê°•ì˜</div>
          {% if ongoing_courses %}
            {% for enrollment in ongoing_courses %}
              <a href="{% url 'classroom:my_course_detail' enrollment.course.course_id %}" class="course-item">
                {{ enrollment.course.title }}
              </a>
            {% endfor %}
          {% else %}
            <div class="empty-courses">ìˆ˜ê°• ì¤‘ì¸ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤</div>
          {% endif %}
      </div>

      <ul class="sidebar-menu">
        <li><a href="{% url 'course:course_list' %}">ğŸ” ê°•ì˜ ì°¾ê¸°</a></li>
        {% if request.user.role == 'instructor' or request.user.role == 'manager' %}
        <li><a href="{% url 'course:course_create' %}">â• ê°•ì˜ ë“±ë¡</a></li>
        {% endif %}
      </ul>
    </aside>

    <main class="main-content">
      <div class="calendar-header">
        <h1 class="calendar-title">ğŸ“… ìº˜ë¦°ë”</h1>
        <div class="calendar-nav">
          <a href="?year={{ prev_year }}&month={{ prev_month }}" class="btn-nav">â—€ ì´ì „</a>
          <span class="current-month">{{ year }}ë…„ {{ month }}ì›”</span>
          <a href="?year={{ next_year }}&month={{ next_month }}" class="btn-nav">ë‹¤ìŒ â–¶</a>
        </div>
      </div>

      <div class="calendar-grid">
        <div class="calendar-day-header">ì¼</div>
        <div class="calendar-day-header">ì›”</div>
        <div class="calendar-day-header">í™”</div>
        <div class="calendar-day-header">ìˆ˜</div>
        <div class="calendar-day-header">ëª©</div>
        <div class="calendar-day-header">ê¸ˆ</div>
        <div class="calendar-day-header">í† </div>

        {% for week in calendar_weeks %}
          {% for day in week %}
          <div class="calendar-day {% if not day.is_current_month %}other-month{% endif %}">
            <div class="calendar-day-number">{{ day.day }}</div>

            {% if day.assignments %}
              {% for assignment in day.assignments %}
              <a href="{% url 'classroom:assignment_detail' assignment.assignment_id %}" style="text-decoration: none;">
                <div class="calendar-event event-assignment" title="[ë§ˆê°] {{ assignment.title }}">
                  â° {{ assignment.title }}
                </div>
              </a>
              {% endfor %}
            {% endif %}

            {% for course in day.courses %}
            <a href="{% url 'classroom:my_course_detail' course.course_id %}" style="text-decoration: none;">
              <div class="calendar-event event-{{ course.category }}" title="{{ course.title }}">
                {% if course.start_time %}
                  {{ course.start_time|date:"H:i" }}
                {% endif %}
                {{ course.title }}
              </div>
            </a>
            {% endfor %}

          </div>
          {% endfor %}
        {% endfor %}
      </div>
    </main>

  </div>
</div>
{% endblock %}