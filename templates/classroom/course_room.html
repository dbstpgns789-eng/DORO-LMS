{% extends "base.html" %}
{% load static %}

{% block title %}{{ course.title }} | ê°•ì˜ì‹¤{% endblock %}

{% block extra_css %}
<style>
  .course-room-container {
    display: flex;
    max-width: 1400px;
    margin: 20px auto;
    gap: 20px;
    padding: 20px;
  }

  /* ì¢Œì¸¡ ì‚¬ì´ë“œë°” */
  .sidebar {
    width: 250px;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 0;
    height: fit-content;
    position: sticky;
    top: 20px;
  }

  .course-info-box {
    padding: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px 8px 0 0;
  }

  .course-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
  }

  .course-instructor {
    font-size: 14px;
    opacity: 0.9;
  }

  .sidebar-menu {
    list-style: none;
    padding: 15px;
    margin: 0;
  }

  .sidebar-menu li {
    margin-bottom: 5px;
  }

  .sidebar-menu a {
    display: block;
    padding: 12px 15px;
    color: #333;
    text-decoration: none;
    border-radius: 5px;
    transition: all 0.2s;
    font-size: 14px;
    cursor: pointer;
  }

  .sidebar-menu a:hover {
    background-color: #f0f0f0;
  }

  .sidebar-menu a.active {
    background-color: #4650D5;
    color: white;
    font-weight: 600;
  }

  /* ë©”ì¸ ì½˜í…ì¸  */
  .main-content {
    flex: 1;
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 30px;
  }

  /* ğŸ‘‡ íƒ­ ì½˜í…ì¸  - ê¸°ë³¸ì€ ìˆ¨ê¹€ */
  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
  }

  .section-title {
    font-size: 24px;
    font-weight: 600;
    margin: 0;
  }

  .btn-create {
    padding: 8px 16px;
    background-color: #4650D5;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-size: 14px;
    white-space: nowrap;
  }

  .btn-create:hover {
    background-color: #3640C5;
  }

  /* ê³µì§€ì‚¬í•­ */
  .notice-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .notice-item {
    padding: 15px;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .notice-item:hover {
    background-color: #f8f9fa;
  }

  .notice-title {
    font-weight: 500;
    color: #333;
  }

  .notice-badge {
    display: inline-block;
    padding: 2px 8px;
    background-color: #dc3545;
    color: white;
    font-size: 11px;
    border-radius: 3px;
    margin-right: 8px;
  }

  .notice-date {
    font-size: 13px;
    color: #666;
  }

  /* ì£¼ì°¨ë³„ ìë£Œ */
  .week-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
  }

  .week-card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    transition: all 0.3s;
  }

  .week-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transform: translateY(-3px);
  }

  .week-number {
    font-size: 14px;
    color: #666;
    margin-bottom: 8px;
  }

  .week-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 10px;
    color: #333;
  }

  .week-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
  }

  .btn-download {
    padding: 6px 12px;
    background-color: #28a745;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 13px;
  }

  .btn-video {
    padding: 6px 12px;
    background-color: #dc3545;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    font-size: 13px;
  }

  /* ê³¼ì œ */
  .assignment-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .assignment-card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .assignment-info {
    flex: 1;
  }

  .assignment-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    color: #333;
  }

  .assignment-meta {
    font-size: 14px;
    color: #666;
  }

  .btn-submit {
    padding: 8px 20px;
    background-color: #4650D5;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-size: 14px;
  }

  .btn-submitted {
    padding: 8px 20px;
    background-color: #28a745;
    color: white;
    border-radius: 5px;
    font-size: 14px;
  }

  /* ì§ˆë¬¸ ê²Œì‹œíŒ */
  .question-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .question-card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 16px;
    transition: all 0.2s;
    text-decoration: none;
    color: inherit;
    display: block;
  }

  .question-card:hover {
    background-color: #f8f9fa;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .question-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 8px;
  }

  .question-title-text {
    font-size: 16px;
    font-weight: 600;
    color: #333;
  }

  .resolved-badge {
    display: inline-block;
    padding: 2px 8px;
    background-color: #28a745;
    color: white;
    font-size: 11px;
    border-radius: 3px;
    margin-left: 8px;
  }

  .question-content {
    font-size: 14px;
    color: #666;
    margin-bottom: 10px;
    line-height: 1.5;
  }

  .question-meta {
    display: flex;
    gap: 15px;
    font-size: 13px;
    color: #999;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #999;
  }

  .empty-state p {
    font-size: 16px;
    margin-bottom: 10px;
  }

  .empty-state a {
    display: inline-block;
    margin-top: 15px;
    padding: 10px 20px;
    background-color: #4650D5;
    color: white;
    text-decoration: none;
    border-radius: 5px;
  }
</style>
{% endblock %}

{% block content %}
<div class="course-room-container">

  <!-- ì¢Œì¸¡ ì‚¬ì´ë“œë°” -->
  <aside class="sidebar">
    <div class="course-info-box">
      <div class="course-title">{{ course.title }}</div>
      <div class="course-instructor">ğŸ‘¨â€ğŸ« {{ course.instructor.name }}</div>
    </div>

    <ul class="sidebar-menu">
      <li><a onclick="showTab('notices')" class="tab-link active" data-tab="notices">ğŸ“¢ ê³µì§€ì‚¬í•­</a></li>
      <li><a onclick="showTab('weekly')" class="tab-link" data-tab="weekly">ğŸ“š ì£¼ì°¨ë³„ ìë£Œ</a></li>
      <li><a onclick="showTab('assignments')" class="tab-link" data-tab="assignments">ğŸ“ ê³¼ì œ</a></li>
      <li><a onclick="showTab('questions')" class="tab-link" data-tab="questions">ğŸ’¬ ì§ˆë¬¸ ê²Œì‹œíŒ</a></li>
      <li><a href="{% url 'classroom:my_classroom' %}">â—€ ë‚´ ê°•ì˜ì‹¤ë¡œ</a></li>
    </ul>
  </aside>

  <!-- ë©”ì¸ ì½˜í…ì¸  -->
  <main class="main-content">

    <!-- ê³µì§€ì‚¬í•­ íƒ­ -->
<div id="notices" class="tab-content active">
  <div class="section-header">
    <h2 class="section-title">ğŸ“¢ ê³µì§€ì‚¬í•­</h2>
    {% if request.user == course.instructor or request.user.role == 'manager' %}
    <a href="{% url 'classroom:notice_create' course.course_id %}" class="btn-create">
      âœï¸ ê³µì§€ ì‘ì„±
    </a>
    {% endif %}
  </div>

  {% if notices %}
  <ul class="notice-list">
    {% for notice in notices %}
    <li class="notice-item" style="cursor: pointer;" onclick="location.href='{% url 'classroom:notice_detail' notice.notice_id %}'">
      <div>
        {% if notice.is_pinned %}
        <span class="notice-badge">ê³µì§€</span>
        {% endif %}
        <span class="notice-title">{{ notice.title }}</span>
      </div>

      <div style="display: flex; gap: 10px; align-items: center;">
        <span class="notice-date">{{ notice.created_at|date:"Y.m.d" }}</span>

        <!-- ğŸ‘‡ ê°•ì‚¬ë§Œ ë³´ì´ëŠ” ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ (í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€) -->
        {% if request.user == course.instructor or request.user.role == 'manager' %}
        <a href="{% url 'classroom:notice_update' notice.notice_id %}"
           onclick="event.stopPropagation();"
           style="padding: 4px 10px; background-color: #ffc107; color: white; text-decoration: none; border-radius: 3px; font-size: 12px;">
          ìˆ˜ì •
        </a>
        <a href="{% url 'classroom:notice_delete' notice.notice_id %}"
           onclick="event.stopPropagation();"
           style="padding: 4px 10px; background-color: #dc3545; color: white; text-decoration: none; border-radius: 3px; font-size: 12px;">
          ì‚­ì œ
        </a>
        {% endif %}
      </div>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <div class="empty-state">
    <p>ğŸ“‹ ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% if request.user == course.instructor or request.user.role == 'manager' %}
    <a href="{% url 'classroom:notice_create' course.course_id %}">
      ì²« ê³µì§€ ì‘ì„±í•˜ê¸°
    </a>
    {% endif %}
  </div>
  {% endif %}
</div>

    <!-- ì£¼ì°¨ë³„ ìë£Œ íƒ­ -->
    <div id="weekly" class="tab-content">
        <div class="section-header">
            <h2 class="section-title">ğŸ“š ì£¼ì°¨ë³„ ê°•ì˜ ìë£Œ</h2>
            {% if request.user == course.instructor or request.user.role == 'manager' %}
            <a href="{% url 'classroom:weekly_create' course.course_id %}" class="btn-create">
            ğŸ“¤ ìë£Œ ì—…ë¡œë“œ
            </a>
            {% endif %}
    </div>

      {% if weekly_contents %}
      <div class="week-grid">

        {% for content in weekly_contents %}
<a href="{% url 'classroom:weekly_detail' content.content_id %}" class="week-card" style="display:block; text-decoration:none; color:inherit;">
  <div class="week-number">{{ content.week_number }}ì£¼ì°¨</div>
  <div class="week-title">{{ content.title }}</div>
  <p style="font-size:14px; color:#666; line-height:1.5;">
    {{ content.description|truncatewords:20 }}
  </p>

  <div class="week-actions">
    {% if content.file %}
    <span class="btn-download">ğŸ“¥ ìë£Œ ë‹¤ìš´ë¡œë“œ</span>
    {% endif %}
    {% if content.video_url %}
    <span class="btn-video">â–¶ï¸ ë™ì˜ìƒ</span>
    {% endif %}
  </div>
</a>
{% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <p>ğŸ“š ë“±ë¡ëœ ê°•ì˜ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      </div>
      {% endif %}
    </div>

<!-- ê³¼ì œ íƒ­ -->
<div id="assignments" class="tab-content">
  <div class="section-header">
    <h2 class="section-title">ğŸ“ ê³¼ì œ</h2>
    {% if request.user == course.instructor or request.user.role == 'manager' %}
    <a href="{% url 'classroom:assignment_create' course.course_id %}" class="btn-create">
      â• ê³¼ì œ ë“±ë¡
    </a>
    {% endif %}
  </div>

  {% if assignments %}
        <div class="assignment-list">
        {% for assignment in assignments %}
        <div class="assignment-card" style="align-items: flex-start;">
          <div class="assignment-info">
            <div class="assignment-title">
              <a href="{% url 'classroom:assignment_detail' assignment.assignment_id %}"
                 style="text-decoration:none; color:#212529;">
                {{ assignment.title }}
              </a>
            </div>
            <div class="assignment-meta">
              ğŸ“… ë§ˆê°: {{ assignment.due_date|date:"Y.m.d H:i" }} |
              ğŸ’¯ ë°°ì : {{ assignment.max_score }}ì 
            </div>
          </div>

          <div style="text-align:right;">
            {# ğŸ‘‡ í•™ìƒì—ê²Œë§Œ ì œì¶œ / ì œì¶œì™„ë£Œ ë²„íŠ¼ í‘œì‹œ #}
            {% if request.user != course.instructor and request.user.role != 'manager' %}
              {% if assignment.assignment_id in submitted_ids %}
              <span class="btn-submitted">âœ… ì œì¶œ ì™„ë£Œ</span>
              {% else %}
              <a href="{% url 'classroom:submit_assignment' assignment.assignment_id %}" class="btn-submit">
                ğŸ“¤ ì œì¶œí•˜ê¸°
              </a>
              {% endif %}
            {% endif %}

            {# ğŸ‘‡ ê°•ì‚¬/ë§¤ë‹ˆì €ì—ê²Œë§Œ ê´€ë¦¬ ë²„íŠ¼ í‘œì‹œ #}
            {% if request.user == course.instructor or request.user.role == 'manager' %}
            <div style="margin-top:8px; display:flex; gap:6px; justify-content:flex-end;">
              <a href="{% url 'classroom:submission_list' assignment.assignment_id %}"
                 style="padding:6px 10px; background:#6c757d; color:#fff; border-radius:4px;
                        font-size:12px; text-decoration:none;">
                ì œì¶œ ëª©ë¡
              </a>
              <a href="{% url 'classroom:assignment_update' assignment.assignment_id %}"
                 style="padding:6px 10px; background:#0d6efd; color:#fff; border-radius:4px;
                        font-size:12px; text-decoration:none;">
                âœï¸ ìˆ˜ì •
              </a>
              <a href="{% url 'classroom:assignment_delete' assignment.assignment_id %}"
                 style="padding:6px 10px; background:#dc3545; color:#fff; border-radius:4px;
                        font-size:12px; text-decoration:none;">
                ğŸ—‘ ì‚­ì œ
              </a>
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>

  {% else %}
  <div class="empty-state">
    <p>ğŸ“ ë“±ë¡ëœ ê³¼ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
    {% if request.user == course.instructor or request.user.role == 'manager' %}
    <a href="{% url 'classroom:assignment_create' course.course_id %}">
      ì²« ê³¼ì œ ë“±ë¡í•˜ê¸°
    </a>
    {% endif %}
  </div>
  {% endif %}
</div>

    <!-- ì§ˆë¬¸ ê²Œì‹œíŒ íƒ­ -->
    <div id="questions" class="tab-content">
      <div class="section-header">
        <h2 class="section-title">ğŸ’¬ ì§ˆë¬¸ ê²Œì‹œíŒ</h2>
        <a href="{% url 'classroom:question_create' course.course_id %}" class="btn-create">
          âœï¸ ì§ˆë¬¸í•˜ê¸°
        </a>
      </div>

      {% if questions %}
      <div class="question-list">
        {% for question in questions %}
        <a href="{% url 'classroom:question_detail' question.question_id %}" class="question-card">
          <div class="question-header">
            <div>
              <span class="question-title-text">{{ question.title }}</span>
              {% if question.is_resolved %}
              <span class="resolved-badge">âœ… í•´ê²°ë¨</span>
              {% endif %}
            </div>
            <span class="notice-date">{{ question.created_at|date:"Y.m.d" }}</span>
          </div>

          <div class="question-content">
            {{ question.content|truncatewords:20 }}
          </div>

          <div class="question-meta">
            <span>ğŸ‘¤ {{ question.author.name }}</span>
            <span>ğŸ’¬ ë‹µë³€ {{ question.answers.count }}ê°œ</span>
          </div>
        </a>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <p>ğŸ’¬ ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <a href="{% url 'classroom:question_create' course.course_id %}">
          ì²« ì§ˆë¬¸ ì‘ì„±í•˜ê¸°
        </a>
      </div>
      {% endif %}
    </div>

  </main>

</div>

<script>
function showTab(tabName) {
  // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¹€
  const allTabs = document.querySelectorAll('.tab-content');
  allTabs.forEach(tab => {
    tab.classList.remove('active');
  });

  // ëª¨ë“  ë©”ë‰´ ë§í¬ active ì œê±°
  const allLinks = document.querySelectorAll('.tab-link');
  allLinks.forEach(link => {
    link.classList.remove('active');
  });

  // ì„ íƒí•œ íƒ­ë§Œ í‘œì‹œ
  document.getElementById(tabName).classList.add('active');

  // ì„ íƒí•œ ë©”ë‰´ì— active ì¶”ê°€
  const selectedLink = document.querySelector(`[data-tab="${tabName}"]`);
  if (selectedLink) {
    selectedLink.classList.add('active');
  }
}
</script>
{% endblock %}
