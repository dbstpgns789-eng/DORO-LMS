{% extends "base.html" %}
{% load static %}

{% block title %}ì»¤ë®¤ë‹ˆí‹° | DORO LMS{% endblock %}

{% block extra_css %}
<style>
  /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
  .notice-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  .notice-table thead tr { background-color: #f8f9fa; border-bottom: 2px solid #dee2e6; }
  .notice-table th { padding: 12px; text-align: center; font-weight: 600; color: #495057; }
  .notice-table td { padding: 12px; border-bottom: 1px solid #dee2e6; }
  .notice-table tbody tr:hover { background-color: #f8f9fa; }
  .notice-title { text-decoration: none; color: #212529; font-weight: 500; }
  .notice-title:hover { color: #0d6efd; }

  /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
  .btn-write {
    display: inline-flex; align-items: center; justify-content: center;
    height: 45px; padding: 0 20px; background-color: #0d6efd; color: white;
    text-decoration: none; border-radius: 5px; font-weight: 600; font-size: 15px;
    border: 1px solid #0d6efd; box-sizing: border-box; vertical-align: middle;
  }
  .btn-write:hover { background-color: #0b5ed7; border-color: #0b5ed7; }

  .btn-my-post {
    display: inline-flex; align-items: center; justify-content: center;
    height: 45px; padding: 0 20px; background-color: #6c757d; color: white;
    text-decoration: none; border-radius: 5px; font-weight: 600; font-size: 15px;
    margin-right: 8px; border: 1px solid #6c757d; box-sizing: border-box; vertical-align: middle;
  }
  .btn-my-post:hover { background-color: #5c636a; border-color: #5c636a; }
  .btn-my-post.active { background-color: #495057; border: 1px solid #343a40; }

  /* íƒœê·¸ ë±ƒì§€ */
  .board-tag {
    display: inline-block; background-color: #e9ecef; color: #495057;
    padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600;
  }

  /* ê²€ìƒ‰ì°½ */
  .search-container { margin-top: 40px; display: flex; justify-content: center; }
  .search-form { display: flex; flex-direction: row; align-items: center; gap: 5px; flex-wrap: nowrap; }
  .search-input {
    padding: 0 12px; border: 1px solid #dee2e6; border-radius: 5px;
    width: 300px; height: 40px; box-sizing: border-box; font-size: 14px;
  }
  .btn-search {
    display: inline-flex; align-items: center; justify-content: center;
    padding: 0 20px; height: 40px; background-color: #6c757d; color: white;
    border: none; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;
  }
  .btn-search:hover { background-color: #5c636a; }

  /* í˜ì´ì§€ë„¤ì´ì…˜ */
  .pagination { margin-top: 30px; display: flex; justify-content: center; align-items: center; gap: 10px; }
  .pagination a {
    text-decoration: none; color: #495057; padding: 5px 10px;
    border: 1px solid #dee2e6; border-radius: 4px; background: white;
  }
  .pagination a:hover { background-color: #f1f3f5; }
  .current-page { font-weight: 700; color: #0d6efd; }

  /* ì¹´í…Œê³ ë¦¬ íƒ­ */
  .category-nav {
    display: flex; gap: 15px; padding: 10px 0; margin-bottom: 5px;
    border-bottom: 1px solid #dee2e6; font-size: 15px; color: #868e96;
  }
  .category-nav a {
    text-decoration: none; color: #868e96; font-weight: 500;
    padding-bottom: 10px; position: relative;
  }
  .category-nav a:hover { color: #495057; }
  .category-nav a.active {
    color: #212529; font-weight: 700; border-bottom: 2px solid #212529;
  }
  .category-divider { color: #dee2e6; font-weight: 300; }
</style>
{% endblock %}

{% block content %}

<main class="card-wrap" style="width: 100%; padding-top: 60px; padding-bottom: 60px;">
  <div class="card-inner">

    <div style="max-width: 1400px; margin: 0 auto;">

      <nav class="category-nav">
        <a href="?board=&q={{ q }}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}" class="{% if not board_type %}active{% endif %}">ì „ì²´</a>
        <span class="category-divider">|</span>
        <a href="?board=free&q={{ q }}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}" class="{% if board_type == 'free' %}active{% endif %}">ììœ </a>
        <span class="category-divider">|</span>
        <a href="?board=qna&q={{ q }}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}" class="{% if board_type == 'qna' %}active{% endif %}">ì§ˆë¬¸</a>
        <span class="category-divider">|</span>
        <a href="?board=discussion&q={{ q }}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}" class="{% if board_type == 'discussion' %}active{% endif %}">í† ë¡ </a>
      </nav>

      <p style="color: #6c757d; font-size: 14px; margin-top: 10px; margin-bottom: 20px;">
        ììœ ë¡­ê²Œ ì§ˆë¬¸í•˜ê³  í† ë¡ í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.
      </p>

      <div style="text-align: right; margin-bottom: 15px; height: 45px;"> {% if request.user.is_authenticated %}

          {% if filter_mode == 'my' %}
            <a href="?board={{ board_type }}" class="btn-my-post active">
              ğŸ“‹ ì „ì²´ ê¸€ ë³´ê¸°
            </a>
          {% else %}
            <a href="?filter=my&board={{ board_type }}" class="btn-my-post">
              ğŸ‘¤ ë‚´ ê²Œì‹œê¸€
            </a>
          {% endif %}

          <a href="{% url 'board:community_create' %}" class="btn-write">
            âœï¸ ê²Œì‹œê¸€ ì‘ì„±
          </a>
        {% endif %}
      </div>

      <table class="notice-table">
        <thead>
          <tr>
            <th style="width: 60px;">ë²ˆí˜¸</th>
            <th style="width: 100px;">ë¶„ë¥˜</th>
            <th style="text-align: left;">ì œëª©</th>
            <th style="width: 120px;">ì‘ì„±ì</th>
            <th style="width: 120px;">ì‘ì„±ì¼</th>
            <th style="width: 80px;">ì¡°íšŒìˆ˜</th>
          </tr>
        </thead>
        <tbody>
          {% for post in posts %}
          <tr>
            <td style="text-align: center;">{{ post.number }}</td>
            <td style="text-align: center;">
              <span class="board-tag">
                {{ post.board }}
              </span>
            </td>
            <td>
              <a href="{% url 'board:community_detail' post.post_id %}" class="notice-title">
                {{ post.post_title }}

                {% if not post.open %}
                  <span style="font-size: 14px; margin-left: 5px;" title="ë¹„ë°€ê¸€">ğŸ”’</span>
                {% endif %}

                {% if post.get_active_comments_count > 0 %}
                  <span style="color: #0d6efd; font-size: 0.9em; font-weight: bold;">
                    [{{ post.get_active_comments_count }}]
                  </span>
                {% endif %}
              </a>
            </td>
            <td style="text-align: center;">{{ post.author.name }}</td>
            <td style="text-align: center;">{{ post.created_at|date:"Y-m-d" }}</td>
            <td style="text-align: center;">{{ post.view }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" style="padding: 50px; text-align: center; color: #6c757d;">
              <p style="font-size: 24px; margin-bottom: 10px;">ğŸ”</p>
              <p>
                {% if filter_mode == 'my' %}
                  ì‘ì„±í•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                {% elif q %}
                  '{{ q }}' ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                {% elif board_type %}
                   í•´ë‹¹ ë¶„ë¥˜ì— ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                {% else %}
                  ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                {% endif %}
              </p>
              {% if request.user.is_authenticated and filter_mode != 'my' %}
                <p style="margin-top: 15px;">
                  <a href="{% url 'board:community_create' %}" class="btn-write">ì²« ê²Œì‹œê¸€ ì‘ì„±í•˜ê¸°</a>
                </p>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      {% if posts.paginator.num_pages > 1 %}
      <div class="pagination">
        {% if posts.has_previous %}
          <a href="?page={{ posts.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if board_type %}&board={{ board_type }}{% endif %}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}">&laquo; ì´ì „</a>
        {% endif %}
        <span class="current-page">
          Page {{ posts.number }} of {{ posts.paginator.num_pages }}
        </span>
        {% if posts.has_next %}
          <a href="?page={{ posts.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if board_type %}&board={{ board_type }}{% endif %}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}">ë‹¤ìŒ &raquo;</a>
        {% endif %}
      </div>
      {% endif %}

      <div class="search-container">
        <form method="get" action="{% url 'board:community_list' %}" class="search-form">
          <input type="hidden" name="board" value="{{ board_type|default:'' }}">

          {% if filter_mode %}
            <input type="hidden" name="filter" value="{{ filter_mode }}">
          {% endif %}

          <input type="text" name="q" class="search-input"
                 value="{{ q|default:'' }}"
                 placeholder="ì œëª©, ë‚´ìš©, ì‘ì„±ì ê²€ìƒ‰">
          <button type="submit" class="btn-search">ê²€ìƒ‰</button>
        </form>
      </div>

    </div> </div>
</main>
{% endblock %}