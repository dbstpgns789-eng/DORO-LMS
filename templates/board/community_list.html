{% extends "base.html" %}
{% load static %}

{% block title %}ì»¤ë®¤ë‹ˆí‹° | DORO LMS{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/community_list.css' %}">
{% endblock %}

{% block content %}
<main class="card-wrap">
  <div class="card-inner">
    <div class="community-container">

      <nav class="category-nav">
        <a href="?board=&q={{ q }}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}" class="{% if not board_type %}active{% endif %}">ì „ì²´</a>
        <span class="category-divider">|</span>
        <a href="?board=free&q={{ q }}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}" class="{% if board_type == 'free' %}active{% endif %}">ììœ </a>
        <span class="category-divider">|</span>
        <a href="?board=qna&q={{ q }}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}" class="{% if board_type == 'qna' %}active{% endif %}">ì§ˆë¬¸</a>
        <span class="category-divider">|</span>
        <a href="?board=discussion&q={{ q }}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}" class="{% if board_type == 'discussion' %}active{% endif %}">í† ë¡ </a>
      </nav>

      <p class="community-intro">ììœ ë¡­ê²Œ ì§ˆë¬¸í•˜ê³  í† ë¡ í•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.</p>

      <div class="list-actions">
        {% if request.user.is_authenticated %}
          {% if filter_mode == 'my' %}
            <a href="?board={{ board_type }}" class="btn-my-post active">ğŸ“‹ ì „ì²´ ê¸€ ë³´ê¸°</a>
          {% else %}
            <a href="?filter=my&board={{ board_type }}" class="btn-my-post">ğŸ‘¤ ë‚´ ê²Œì‹œê¸€</a>
          {% endif %}
          <a href="{% url 'board:community_create' %}" class="btn-write">âœï¸ ê²Œì‹œê¸€ ì‘ì„±</a>
        {% endif %}
      </div>

      <table class="notice-table">
        <thead>
          <tr>
            <th style="width: 60px;">ë²ˆí˜¸</th>
            <th style="width: 100px;">ë¶„ë¥˜</th>
            <th style="text-align: left;">ì œëª©</th>
            <th style="width: 120px;">ì‘ì„±ì</th>
            <th style="width: 120px;">ì‘ì„±ì¼</th>
            <th style="width: 80px;">ì¡°íšŒìˆ˜</th>
          </tr>
        </thead>
        <tbody>
          {% for post in posts %}
          <tr>
            <td style="text-align: center;">{{ post.number }}</td>
            <td style="text-align: center;">
              <span class="board-tag">{{ post.board }}</span>
            </td>
            <td>
              <a href="{% url 'board:community_detail' post.post_id %}" class="notice-title">
                {{ post.post_title }}
                {% if not post.open %}
                  <span class="secret-icon" title="ë¹„ë°€ê¸€">ğŸ”’</span>
                {% endif %}
                {% if post.get_active_comments_count > 0 %}
                  <span class="comment-count">[{{ post.get_active_comments_count }}]</span>
                {% endif %}
              </a>
            </td>
            <td style="text-align: center;">{{ post.author.name }}</td>
            <td style="text-align: center;">{{ post.created_at|date:"Y-m-d" }}</td>
            <td style="text-align: center;">{{ post.view }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="empty-state">
              <p class="empty-icon">ğŸ”</p>
              <p>
                {% if filter_mode == 'my' %} ì‘ì„±í•œ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                {% elif q %} '{{ q }}' ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
                {% elif board_type %} í•´ë‹¹ ë¶„ë¥˜ì— ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                {% else %} ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.
                {% endif %}
              </p>
              {% if request.user.is_authenticated and filter_mode != 'my' %}
                <p style="margin-top: 15px;">
                  <a href="{% url 'board:community_create' %}" class="btn-write">ì²« ê²Œì‹œê¸€ ì‘ì„±í•˜ê¸°</a>
                </p>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      {% if posts.paginator.num_pages > 1 %}
      <div class="pagination">
        {% if posts.has_previous %}
          <a href="?page={{ posts.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if board_type %}&board={{ board_type }}{% endif %}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}">&laquo; ì´ì „</a>
        {% endif %}
        <span class="current-page">Page {{ posts.number }} of {{ posts.paginator.num_pages }}</span>
        {% if posts.has_next %}
          <a href="?page={{ posts.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if board_type %}&board={{ board_type }}{% endif %}{% if filter_mode %}&filter={{ filter_mode }}{% endif %}">ë‹¤ìŒ &raquo;</a>
        {% endif %}
      </div>
      {% endif %}

      <div class="search-container">
        <form method="get" action="{% url 'board:community_list' %}" class="search-form">
          <input type="hidden" name="board" value="{{ board_type|default:'' }}">
          {% if filter_mode %}
            <input type="hidden" name="filter" value="{{ filter_mode }}">
          {% endif %}
          <input type="text" name="q" class="search-input" value="{{ q|default:'' }}" placeholder="ì œëª©, ë‚´ìš©, ì‘ì„±ì ê²€ìƒ‰">
          <button type="submit" class="btn-search">ê²€ìƒ‰</button>
        </form>
      </div>

    </div>
  </div>
</main>
{% endblock %}