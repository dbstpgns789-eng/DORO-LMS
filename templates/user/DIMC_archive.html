{% extends "base.html" %}
{% load static %}

{% block title %}DIMC ì•„ì¹´ì´ë¸Œ{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/mypage.css' %}?v=20251128_2">

<style>
  /* ë©”ë‰´ ìœ„ì¹˜ ë³´ì • */
  #menuItem3{
    position:absolute !important;
    left:238px !important;
    top:calc(var(--content-top) + 455px) !important;
    font-size:20px;
    color:var(--ink);
    white-space:nowrap;
    text-decoration:none;
  }

  /* infoBox ìŠ¤íƒ€ì¼ */
  #infoBox {
      position: absolute;
      left: 490px;
      top: 321px;
      width: 685px;
      background: #fff;
      border: none;
      border-radius: 10px;
      box-sizing: border-box;
      padding-bottom: 50px;
  }

  #archiveTitle {
      position: absolute;
      left: 29px;
      top: 36px;
      font-size: 24px;
      color: #000;
      font-weight: bold;
  }

  #archiveSub {
      position: absolute;
      left: 29px;
      top: 79px;
      width: 600px;
      font-size: 14px;
      line-height: 20px;
      color: #717070;
      text-align: left;
  }

  #archivePanel {
      position: relative;
      margin-top: 140px;
      margin-left: 29px;
      width: 625px;
      background: rgba(229, 229, 229, 0.42);
      border-radius: 10px;
      padding: 25px;
      box-sizing: border-box;
  }

  .form-row {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      width: 100%;
  }

  .dimc-badge {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 130px;
      height: 36px;
      margin-right: 15px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      font-size: 14px;
      box-sizing: border-box;
      flex-shrink: 0;
  }
  .badge-d { background-color: #4650D5; }
  .badge-i { background-color: #D96C75; }
  .badge-m { background-color: #DCE33D; color: #333; }
  .badge-c { background-color: #2A2A89; }

  .form-label {
      display: inline-block;
      width: 130px;
      font-size: 14px;
      color: #000;
      font-weight: 500;
      margin-right: 15px;
      padding-left: 10px;
      box-sizing: border-box;
  }

  .form-input {
      flex: 1;
      height: 36px;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 0 10px;
      font-size: 14px;
      background: #fff;
  }

  /* ê²°ê³¼ í‘œì‹œìš© ìŠ¤íƒ€ì¼ ì¶”ê°€ */
  .result-display {
      flex: 1;
      height: 36px;
      display: flex;
      align-items: center;
      font-size: 16px;
      font-weight: bold;
      color: #5651E9;
  }

  .file-row {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px dashed #ccc;
      display: flex;
      align-items: flex-start;
  }

  .file-group {
      display: flex;
      flex-direction: column;
  }

  .file-tip {
      font-size: 12px;
      color: #717070;
      margin-top: 5px;
  }

  #archiveActions {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 15px;
  }

  .btn-purple {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 90px;
      height: 40px;
      padding: 0 20px;
      background: #5651E9;
      border-radius: 10px;
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: opacity 0.2s;
      border: none;
      text-decoration: none;
  }
  .btn-purple:hover { opacity: 0.9; }
</style>
{% endblock %}

{% block content %}
<div id="canvas" role="main">
  <div id="bgMypage"></div>
  <h1 id="pageTitle">ë§ˆì´í˜ì´ì§€</h1>

  <div id="menuTitle">ë©”ë‰´</div>
  <div id="menuBox"></div>
  <div id="menuLine1"></div>
  <div id="menuLine2"></div>
  <a id="menuItem1" href="{% url 'user:mypage' %}">ë‚´ ì •ë³´</a>
  <a id="menuItem2" href="{% url 'user:DIMC_archive' %}">DIMC ì•„ì¹´ì´ë¸Œ</a>
  <a id="menuItem3" href="{% url 'user:dimc_results' %}">DIMC ì—…ë¡œë“œ ë‚´ì—­</a>

  <section id="infoBox">
      <div id="archiveTitle">ê²°ê³¼ì§€ ì—…ë¡œë“œ</div>

      <div id="archiveSub">
          DIMC ì§„ë‹¨ ì ìˆ˜ë¥¼ ì…ë ¥í•˜ë©´ <strong>ê²°ê³¼ ìœ í˜•ì´ ìë™ìœ¼ë¡œ ê³„ì‚°</strong>ë©ë‹ˆë‹¤.<br>
          ì ìˆ˜ë¥¼ í™•ì¸í•˜ê³  ê²°ê³¼ì§€ íŒŒì¼ì„ ì„ íƒí•œ ë’¤ ì €ì¥í•´ ì£¼ì„¸ìš”.
      </div>

      <div id="archivePanel">
          <form method="post" enctype="multipart/form-data">
              {% csrf_token %}

              <div class="form-row">
                  <label class="dimc-badge badge-d">D (Digital)</label>
                  <input type="number" name="D_score" id="D_score" class="form-input calc-target" min="0" max="100" required>
              </div>

              <div class="form-row">
                  <label class="dimc-badge badge-i">I (AI)</label>
                  <input type="number" name="I_score" id="I_score" class="form-input calc-target" min="0" max="100" required>
              </div>

              <div class="form-row">
                  <label class="dimc-badge badge-m">M (Making)</label>
                  <input type="number" name="M_score" id="M_score" class="form-input calc-target" min="0" max="100" required>
              </div>

              <div class="form-row">
                  <label class="dimc-badge badge-c">C (Computing)</label>
                  <input type="number" name="C_score" id="C_score" class="form-input calc-target" min="0" max="100" required>
              </div>

              <div class="form-row">
                  <label class="form-label">íŒì • ê²°ê³¼</label>
                  <div id="shark_result_text" class="result-display">
                      ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
                  </div>
              </div>

              <div class="file-row">
                  <label class="form-label">íŒŒì¼ ì„ íƒ</label>
                  <div class="file-group">
                      <input type="file" name="pdf_path" required>
                      <span class="file-tip">* PDF, JPG, PNG íŒŒì¼ ì—…ë¡œë“œ ê°€ëŠ¥</span>
                  </div>
              </div>

              <div id="archiveActions">
                  <button type="submit" class="btn-purple">ì €ì¥í•˜ê¸°</button>
                  <a href="{% url 'user:dimc_results' %}" class="btn-purple">ì—…ë¡œë“œ ë‚´ì—­ ë³´ê¸°</a>
              </div>
          </form>
      </div>
  </section>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const inputs = document.querySelectorAll('.calc-target');
    const resultText = document.getElementById('shark_result_text');

    inputs.forEach(input => {
        input.addEventListener('input', calculateShark);
    });

    function calculateShark() {
        // ğŸ‘‡ ìˆ˜ì •ë¨: IDë¥¼ ëŒ€ë¬¸ìë¡œ ë³€ê²½í•˜ì—¬ ê°’ì„ ê°€ì ¸ì˜´
        const d = parseInt(document.getElementById('D_score').value) || 0;
        const i = parseInt(document.getElementById('I_score').value) || 0;
        const m = parseInt(document.getElementById('M_score').value) || 0;
        const c = parseInt(document.getElementById('C_score').value) || 0;

        const scores = { 'D': d, 'I': i, 'M': m, 'C': c };
        const vals = Object.values(scores);

        // 95ì , 90ì  ì´ìƒ ê°œìˆ˜
        const count95 = vals.filter(v => v >= 95).length;
        const count90 = vals.filter(v => v >= 90).length;

        let sharkName = "";

        if (count95 >= 4) {
            sharkName = "ë°±ìƒì•„ë¦¬";
        } else if (count95 >= 2) {
            sharkName = "ì²­ìƒì•„ë¦¬";
        } else if (count90 >= 2) {
            sharkName = "ê³ ë˜ìƒì–´";
        } else {
            // ê°€ì¥ ë†’ì€ ì ìˆ˜ ì°¾ê¸° (ë™ì ì¼ ê²½ìš° D, I, M, C ìˆœ)
            let maxVal = -1;
            let maxKey = '';
            for (const [key, val] of Object.entries(scores)) {
                if (val > maxVal) {
                    maxVal = val;
                    maxKey = key;
                }
            }

            if (maxVal >= 90) {
                if (maxKey === 'D') sharkName = "ê·¸ë¦°ë€ë“œ ìƒì–´";
                else if (maxKey === 'I') sharkName = "ë ˆëª¬ ìƒì–´";
                else if (maxKey === 'M') sharkName = "ë§ì¹˜ ìƒì–´";
                else if (maxKey === 'C') sharkName = "ë±€ ìƒì–´";
            } else if (maxVal >= 75) {
                if (maxKey === 'D') sharkName = "ë„“ì€ ì£¼ë‘¥ì´ ìƒì–´";
                else if (maxKey === 'I') sharkName = "íŒŒìë§ˆ ìƒì–´";
                else if (maxKey === 'M') sharkName = "í†± ìƒì–´";
                else if (maxKey === 'C') sharkName = "ì²œì‚¬ ìƒì–´";
            } else if (maxVal >= 50) {
                if (maxKey === 'D') sharkName = "ëª¨ë˜ ìƒì–´";
                else if (maxKey === 'I') sharkName = "ì• í”Œë › ìƒì–´";
                else if (maxKey === 'M') sharkName = "ë„ˆìŠ¤ ìƒì–´";
                else if (maxKey === 'C') sharkName = "ì•”ì´ˆ ìƒì–´";
            } else {
                sharkName = "ì•„ê¸° ìƒì–´";
            }
        }

        // ì…ë ¥ê°’ì´ í•˜ë‚˜ë¼ë„ ìˆì„ ë•Œë§Œ ê²°ê³¼ í‘œì‹œ
        if (d+i+m+c > 0) {
            resultText.innerText = sharkName;
        } else {
            resultText.innerText = "ì ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”";
        }
    }
});
</script>
{% endblock %}