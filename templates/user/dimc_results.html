{% extends "base.html" %}
{% load static %}

{% block title %}DIMC 아카이브 목록{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/mypage.css' %}?v=20251128_2">
<style>
  /* 이 페이지에서 사이드바 3개 메뉴 위치 통일 */
  #menuItem1,
  #menuItem2,
  #menuItem3{
    position:absolute;
    left:238px;
    font-size:20px;
    color:#000;
    white-space:nowrap;
    text-decoration:none;
  }
  #menuItem1{ top:calc(var(--content-top, 0px) + 343px); }
  #menuItem2{ top:calc(var(--content-top, 0px) + 399px); }
  #menuItem3{ top:calc(var(--content-top, 0px) + 455px); }

  /* 우측 목록 카드만 살짝 꾸미기 */
  .dimc-list-card{
    position:absolute;
    left:490px;
    top:321px;
    width:685px;
    background:#fff;
    border:1px solid #CBC6C6;
    border-radius:10px;
    padding:28px 24px 32px;
    box-sizing:border-box;
    box-shadow:0 4px 10px rgba(0,0,0,.03);
  }
  .dimc-list-title{
    font-size:22px;
    font-weight:700;
    margin-bottom:8px;
  }
  .dimc-list-desc{
    font-size:14px;
    color:#717070;
    margin-bottom:18px;
  }
  .dimc-table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
  }
  .dimc-table thead th{
    padding:8px;
    border-bottom:1px solid #ddd;
    background:#f8f9fa;
    text-align:center;
  }
  .dimc-table tbody td{
    padding:8px;
    border-bottom:1px solid #eee;
  }
  .dimc-table tbody td.num{
    text-align:center;
  }
  .dimc-empty{
    font-size:14px;
    color:#999;
    margin-top:4px;
  }
</style>
{% endblock %}

{% block content %}
<div id="canvas" role="main">
  <div id="bgMypage"></div>
  <h1 id="pageTitle">마이페이지</h1>

  <!-- 좌측 사이드바 (마이페이지와 동일) -->
  <div id="menuTitle">메뉴</div>
  <div id="menuBox"></div>
  <div id="menuLine1"></div>
  <div id="menuLine2"></div>
  <a id="menuItem1" href="{% url 'user:mypage' %}">내 정보</a>
  <a id="menuItem2" href="{% url 'user:DIMC_archive' %}">DIMC 아카이브</a>
  <a id="menuItem3" href="{% url 'user:dimc_results' %}">DIMC 업로드 내역</a>

  <!-- 우측 업로드 내역 카드 -->
  <section class="dimc-list-card">
    <h2 class="dimc-list-title">업로드 내역</h2>
    <p class="dimc-list-desc">
      내가 업로드한 DIMC 점수와 검사지를 한눈에 확인할 수 있습니다.
    </p>

    {% if results %}
    <table class="dimc-table">
      <thead>
        <tr>
          <th>날짜</th>
          <th>D</th>
          <th>I</th>
          <th>M</th>
          <th>C</th>
          <th>결과 요약</th>
          <th>검사지</th>
        </tr>
      </thead>
      <tbody>
        {% for item in results %}
        <tr>
          <td>{{ item.tested_at|date:"Y-m-d" }}</td>
          <td class="num">{{ item.D_score }}</td>
          <td class="num">{{ item.I_score }}</td>
          <td class="num">{{ item.M_score }}</td>
          <td class="num">{{ item.C_score }}</td>
          <td style="max-width:200px;">
            {{ item.result|truncatechars:40 }}
          </td>
          <td class="num">
            {% if item.pdf_path %}
              <a href="{{ item.pdf_path.url }}" target="_blank" style="color:#4650D5; font-weight:600;">
                보기
              </a>
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="dimc-empty">아직 업로드된 DIMC 결과가 없습니다.</p>
    {% endif %}
  </section>
</div>
{% endblock %}
