{% extends "base.html" %}
{% load static %}

{% block title %}DIMC 아카이브 목록{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/mypage.css' %}?v=20251128_2">
<style>
  /* 사이드바 위치 (기존 유지) */
  #menuItem1, #menuItem2, #menuItem3{
    position:absolute;
    left:238px;
    font-size:20px;
    color:#000;
    white-space:nowrap;
    text-decoration:none;
  }
  #menuItem1{ top:calc(var(--content-top, 0px) + 343px); }
  #menuItem2{ top:calc(var(--content-top, 0px) + 399px); }
  #menuItem3{ top:calc(var(--content-top, 0px) + 455px); }

  /* 리스트 카드 스타일 */
  .dimc-list-card{
    position:absolute;
    left:490px;
    top:321px;
    width:685px;
    background:#fff;
    border:1px solid #CBC6C6;
    border-radius:10px;
    padding:28px 24px 32px;
    box-sizing:border-box;
    box-shadow:0 4px 10px rgba(0,0,0,.03);
  }
  .dimc-list-title{ font-size:22px; font-weight:700; margin-bottom:8px; }
  .dimc-list-desc{ font-size:14px; color:#717070; margin-bottom:18px; }

  /* === [추가됨] 계급도 바로가기 버튼 스타일 === */
  .btn-rank-map {
      position: absolute;
      top: 28px;     /* 카드 상단 여백과 동일하게 맞춤 */
      right: 24px;   /* 카드 우측 여백과 동일하게 맞춤 */
      padding: 6px 14px;
      background-color: #5651E9; /* 보라색 포인트 컬러 */
      color: #fff;
      border-radius: 6px;
      font-size: 13px;
      font-weight: bold;
      text-decoration: none;
      transition: background-color 0.2s;
  }
  .btn-rank-map:hover {
      background-color: #4650D5;
  }

  /* 테이블 스타일 */
  .dimc-table{ width:100%; border-collapse:collapse; font-size:14px; }
  .dimc-table thead th{
    padding:10px 8px;
    border-bottom:1px solid #ddd;
    background:#f8f9fa;
    text-align:center;
    font-weight: 600;
  }
  .dimc-table tbody td{
    padding:12px 8px;
    border-bottom:1px solid #eee;
    text-align: center;
    vertical-align: middle;
  }

  /* 상어 결과 강조 */
  .shark-result {
      color: #5651E9;
      font-weight: bold;
  }

  .btn-view {
      display: inline-block;
      padding: 4px 12px;
      background-color: #f1f3f5;
      color: #4650D5;
      border-radius: 4px;
      font-size: 12px;
      text-decoration: none;
      font-weight: 600;
      transition: 0.2s;
  }
  .btn-view:hover { background-color: #e9ecef; }

  .dimc-empty{ font-size:14px; color:#999; margin-top:20px; text-align: center; }
</style>
{% endblock %}

{% block content %}
<div id="canvas" role="main">
  <div id="bgMypage"></div>
  <h1 id="pageTitle">마이페이지</h1>

  <div id="menuTitle">메뉴</div>
  <div id="menuBox"></div>
  <div id="menuLine1"></div>
  <div id="menuLine2"></div>
  <a id="menuItem1" href="{% url 'user:mypage' %}">내 정보</a>
  <a id="menuItem2" href="{% url 'user:DIMC_archive' %}">DIMC 아카이브</a>
  <a id="menuItem3" href="{% url 'user:dimc_results' %}">DIMC 업로드 내역</a>

  <section class="dimc-list-card">
    <a href="https://dimctest.com/rank" target="_blank" class="btn-rank-map">
        계급도 확인
    </a>

    <h2 class="dimc-list-title">업로드 내역</h2>
    <p class="dimc-list-desc">
      내가 업로드한 DIMC 점수와 분석 결과(상어 유형)를 확인하세요.
    </p>

    {% if results %}
    <table class="dimc-table">
      <thead>
        <tr>
          <th style="width: 15%;">날짜</th>
          <th style="width: 10%;">D</th>
          <th style="width: 10%;">I</th>
          <th style="width: 10%;">M</th>
          <th style="width: 10%;">C</th>
          <th style="width: 30%;">결과 유형</th>
          <th style="width: 15%;">검사지</th>
        </tr>
      </thead>
      <tbody>
        {% for item in results %}
        <tr>
          <td>{{ item.tested_at|date:"Y.m.d" }}</td>
          <td>{{ item.D_score }}</td>
          <td>{{ item.I_score }}</td>
          <td>{{ item.M_score }}</td>
          <td>{{ item.C_score }}</td>

          <td>
             <span class="shark-result">{{ item.result }}</span>
          </td>

          <td>
            {% if item.pdf_path %}
              <a href="{{ item.pdf_path.url }}" target="_blank" class="btn-view">
                보기
              </a>
            {% else %}
              <span style="color:#ccc;">-</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="dimc-empty">아직 업로드된 DIMC 결과가 없습니다.</p>
    {% endif %}
  </section>
</div>
{% endblock %}