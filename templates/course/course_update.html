{% extends "base.html" %}
{% load static %}

{% block title %}강의 관리 | DORO LMS{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/course_update.css' %}">
{% endblock %}

{% block content %}
<section class="hero">
  <div class="hero-inner">
    <h1 class="hero-title">{% if course %}강의 수정{% else %}강의 등록{% endif %}</h1>
  </div>
</section>

<main class="card-wrap">
  <div class="card-inner">
    <form method="post" enctype="multipart/form-data" class="update-form">
      {% csrf_token %}

      <div class="form-group">
        <label class="form-label">{{ form.title.label }}</label>
        {{ form.title }}
        {% if form.title.errors %}
          <p class="error-msg">{{ form.title.errors }}</p>
        {% endif %}
      </div>

      <div class="form-group">
        <label class="form-label">강의 대표 이미지</label>

        {% if course.image %}
          <div class="current-image-box" id="image-preview-box">
            <p class="preview-label">현재 이미지:</p>

            <div class="image-wrapper">
              <img src="{{ course.image.url }}" alt="현재 이미지" class="current-img">

              <label for="image-clear-checkbox" class="btn-image-delete" title="이미지 삭제">
                ✕
              </label>
            </div>

            <div style="display: none;">
              <input type="checkbox" name="image-clear" id="image-clear-checkbox">
            </div>

            <p id="delete-msg" class="delete-warning-text">
              ⚠️ '수정하기'를 누르면 이미지가 삭제됩니다.
            </p>
          </div>
        {% endif %}

        <div>
          <label class="file-input-label">
            {% if course.image %}이미지 변경 (새 파일 선택 시 기존 이미지 대체):{% else %}이미지 등록:{% endif %}
          </label>
          {{ form.image }}
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">{{ form.description.label }}</label>
        {{ form.description }}
        {% if form.description.errors %}
          <p class="error-msg">{{ form.description.errors }}</p>
        {% endif %}
      </div>

      <div class="checkbox-group">
        <label class="checkbox-label">
          {{ form.is_active }}
          <span class="checkbox-text">{{ form.is_active.label }}</span>
        </label>
      </div>

      <div class="form-actions">
        {% if course %}
          <a href="{% url 'course:course_detail' course.course_id %}" class="btn btn-secondary">취소</a>
          <button type="submit" class="btn btn-primary">수정하기</button>
        {% else %}
          <a href="{% url 'course:course_list' %}" class="btn btn-secondary">취소</a>
          <button type="submit" class="btn btn-success">등록하기</button>
        {% endif %}
      </div>
    </form>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const clearCheckbox = document.getElementById('image-clear-checkbox');
    const previewBox = document.getElementById('image-preview-box');
    const deleteMsg = document.getElementById('delete-msg');

    if(clearCheckbox && previewBox) {
      clearCheckbox.addEventListener('change', function() {
        if(this.checked) {
          previewBox.classList.add('image-deleted');
          deleteMsg.style.display = 'block';
        } else {
          previewBox.classList.remove('image-deleted');
          deleteMsg.style.display = 'none';
        }
      });
    }
  });
</script>
{% endblock %}