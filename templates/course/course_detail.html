{% extends "base.html" %}
{% load static %}

{% block title %}{{ course.title }} | DORO LMS{% endblock %}

{% block extra_css %}
<style>
  .course-detail {
    max-width: 1000px;
    margin: 50px auto;
    padding: 30px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  .alert {
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 5px;
    white-space: pre-line;
  }

  .alert-danger {
    background-color: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
  }

  .alert-success {
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
  }

  .course-header {
    margin-bottom: 30px;
  }

  .course-title {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 15px;
    color: #212529;
  }

  .course-meta {
    display: flex;
    gap: 20px;
    color: #666;
    font-size: 14px;
    margin-bottom: 20px;
  }

  .course-info-box {
    background-color: #f8f9fa;
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 30px;
  }

  .info-row {
    display: flex;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #e0e0e0;
  }

  .info-row:last-child {
    border-bottom: none;
  }

  .info-label {
    font-weight: 600;
    color: #333;
  }

  .info-value {
    color: #666;
  }

  .course-description {
    line-height: 1.8;
    margin-bottom: 30px;
  }

  /* ğŸ‘‡ ê´€ë¦¬ ë²„íŠ¼ */
  .admin-buttons {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    padding: 15px;
    background-color: #fff3cd;
    border-radius: 8px;
  }

  .btn-edit {
    padding: 10px 20px;
    background-color: #0d6efd;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: 600;
  }

  .btn-edit:hover {
    background-color: #0b5ed7;
  }

  .btn-delete {
    padding: 10px 20px;
    background-color: #dc3545;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: 600;
  }

  .btn-delete:hover {
    background-color: #bb2d3b;
  }

  .btn-enroll {
    display: inline-block;
    padding: 15px 40px;
    background-color: #4285F4;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: 600;
    font-size: 16px;
  }

  .btn-enroll:hover {
    background-color: #3367D6;
  }

  .btn-enrolled {
    background-color: #28a745;
  }

  .btn-disabled {
    background-color: #6c757d;
    cursor: not-allowed;
  }
</style>
{% endblock %}

{% block content %}
<div class="course-detail">

  <!-- ë©”ì‹œì§€ í‘œì‹œ -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <!-- ğŸ‘‡ ê°•ì‚¬ ë³¸ì¸ ë˜ëŠ” ê´€ë¦¬ìë§Œ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ -->
  {% if user.is_authenticated %}
    {% if user == course.instructor or user.role == "manager" %}
    <div class="admin-buttons">
      <span style="flex: 1; font-weight: 600; color: #856404;">ğŸ“ ê°•ì˜ ê´€ë¦¬</span>
      <a href="{% url 'course:course_update' course.course_id %}" class="btn-edit">âœï¸ ìˆ˜ì •</a>
      <a href="{% url 'course:course_delete' course.course_id %}" class="btn-delete">ğŸ—‘ï¸ ì‚­ì œ</a>
    </div>
    {% endif %}
  {% endif %}

  <div class="course-header">
    <h1 class="course-title">{{ course.title }}</h1>

    <div class="course-meta">
      <span>ğŸ‘¨â€ğŸ« ê°•ì‚¬: {{ course.instructor.name }}</span>
      <span>ğŸ“‚ ì¹´í…Œê³ ë¦¬: {{ course.get_category_display }}</span>
      <span>ğŸ‘ï¸ ì¡°íšŒìˆ˜: {{ course.views }}</span>
    </div>
  </div>

  <!-- ê°•ì˜ ì •ë³´ -->
  <div class="course-info-box">
    <h3 style="margin-bottom: 15px; font-size: 20px; font-weight: 600;">ğŸ“‹ ê°•ì˜ ì •ë³´</h3>

    <div class="info-row">
      <span class="info-label">ğŸ“† ìˆ˜ê°• ê¸°ê°„</span>
      <span class="info-value">{{ course.start_date }} ~ {{ course.end_date }}</span>
    </div>

    <div class="info-row">
      <span class="info-label">ğŸ“… ê°•ì˜ ìš”ì¼</span>
      <span class="info-value">{{ course.get_weekday_display }}</span>
    </div>

    <div class="info-row">
      <span class="info-label">â° ê°•ì˜ ì‹œê°„</span>
      <span class="info-value">{{ course.start_time|date:"H:i" }} - {{ course.end_time|date:"H:i" }}</span>
    </div>

    <div class="info-row">
      <span class="info-label">ğŸ“š ë“±ë¡ì¼</span>
      <span class="info-value">{{ course.created_at|date:"Yë…„ mì›” dì¼" }}</span>
    </div>
  </div>

  <!-- ê°•ì˜ ì´ë¯¸ì§€ -->
  {% if course.image %}
  <div style="margin-bottom: 30px;">
    <img src="{{ course.image.url }}" alt="{{ course.title }}" style="width: 100%; max-width: 600px; border-radius: 8px;">
  </div>
  {% endif %}

  <!-- ê°•ì˜ ì„¤ëª… -->
  <div class="course-description">
    <h3 style="margin-bottom: 15px; font-size: 20px; font-weight: 600;">ğŸ“ ê°•ì˜ ì„¤ëª…</h3>
    <p style="font-size: 16px; line-height: 1.8; color: #333;">{{ course.description }}</p>
  </div>

  <!-- ìˆ˜ê°• ì‹ ì²­ ë²„íŠ¼ -->
  {% if user.is_authenticated %}
    {% if is_enrolled %}
      <a href="{% url 'classroom:my_classroom' %}" class="btn-enroll btn-enrolled">
        âœ… ìˆ˜ê°• ì¤‘ - ë‚´ ê°•ì˜ì‹¤ë¡œ ì´ë™
      </a>
    {% else %}
      {% if course.is_expired %}
        <span class="btn-enroll btn-disabled">
          â° ìˆ˜ê°• ê¸°ê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤
        </span>
      {% else %}
        <a href="{% url 'classroom:enroll' course.course_id %}" class="btn-enroll">
          ğŸ“š ìˆ˜ê°• ì‹ ì²­í•˜ê¸°
        </a>
      {% endif %}
    {% endif %}
  {% else %}
    <p style="color: #666; font-size: 16px;">ë¡œê·¸ì¸ í›„ ìˆ˜ê°• ì‹ ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
    <a href="{% url 'user:login' %}" class="btn-enroll">ë¡œê·¸ì¸í•˜ê¸°</a>
  {% endif %}

</div>
{% endblock %}
