{% extends "base.html" %}
{% load static %}

{% block title %}Í∞ïÏùò Îì±Î°ù | DORO LMS{% endblock %}

{% block extra_css %}
<style>
  .form-container {
    max-width: 800px;
    margin: 50px auto;
    padding: 30px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  }

  .form-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 30px;
    text-align: center;
  }

  .alert {
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 5px;
  }

  .alert-danger {
    background-color: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #333;
  }

  /* üëá ÌïÑÏàò ÌïÑÎìú ÌëúÏãú */
  .form-group label.required:after {
    content: " *";
    color: red;
  }

  .form-control {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
  }

  .form-control:focus {
    outline: none;
    border-color: #4285F4;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 15px;
  }

  .form-row-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
  }

  .image-preview {
    margin-top: 15px;
    max-width: 400px;
  }

  .image-preview img {
    width: 100%;
    border-radius: 8px;
    border: 2px solid #ddd;
  }

  .btn-submit {
    width: 100%;
    padding: 15px;
    background-color: #4285F4;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 20px;
  }

  .btn-submit:hover {
    background-color: #3367D6;
  }

  .btn-cancel {
    display: block;
    text-align: center;
    margin-top: 15px;
    color: #666;
    text-decoration: none;
  }

  .errorlist {
    list-style: none;
    padding: 0;
    margin: 5px 0 0 0;
  }

  .errorlist li {
    color: #dc3545;
    font-size: 13px;
    margin-top: 5px;
    padding: 5px 10px;
    background-color: #f8d7da;
    border-radius: 3px;
    white-space: pre-line;
  }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
  <h1 class="form-title">{% if form.instance.pk %}Í∞ïÏùò ÏàòÏ†ï{% else %}Í∞ïÏùò Îì±Î°ù{% endif %}</h1>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  {% if form.non_field_errors %}
    <div class="alert alert-danger">
      <strong>‚ö†Ô∏è Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§:</strong>
      <ul>
        {% for error in form.non_field_errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <!-- Í∞ïÏùòÎ™Ö -->
    <div class="form-group">
      <label for="{{ form.title.id_for_label }}" class="required">{{ form.title.label }}</label>
      {{ form.title }}
      {% if form.title.errors %}
        <ul class="errorlist">
          {% for error in form.title.errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>

    <!-- Í∞ïÏùò ÏÑ§Î™Ö -->
    <div class="form-group">
      <label for="{{ form.description.id_for_label }}" class="required">{{ form.description.label }}</label>
      {{ form.description }}
      {% if form.description.errors %}
        <ul class="errorlist">
          {% for error in form.description.errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>

    <!-- Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú -->
    <div class="form-group">
      <label for="{{ form.image.id_for_label }}">{{ form.image.label }}</label>
      {{ form.image }}
      {% if form.image.errors %}
        <ul class="errorlist">
          {% for error in form.image.errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      {% endif %}

      {% if form.instance.image %}
      <div class="image-preview">
        <p style="font-size: 13px; color: #666; margin-top: 10px;">ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ:</p>
        <img src="{{ form.instance.image.url }}" alt="ÌòÑÏû¨ Ïç∏ÎÑ§Ïùº">
      </div>
      {% endif %}

      <div class="image-preview" id="newImagePreview" style="display: none;">
        <p style="font-size: 13px; color: #666; margin-top: 10px;">ÏÉà Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞:</p>
        <img id="preview" src="" alt="ÎØ∏Î¶¨Î≥¥Í∏∞">
      </div>
    </div>

    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ -->
    <div class="form-group">
      <label for="{{ form.category.id_for_label }}" class="required">{{ form.category.label }}</label>
      {{ form.category }}
      {% if form.category.errors %}
        <ul class="errorlist">
          {% for error in form.category.errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>

    <!-- üëá ÏöîÏùº + ÏãúÍ∞Ñ (ÌïÑÏàò) -->
    <div class="form-row">
      <div class="form-group">
        <label for="{{ form.weekday.id_for_label }}" class="required">{{ form.weekday.label }}</label>
        {{ form.weekday }}
        {% if form.weekday.errors %}
          <ul class="errorlist">
            {% for error in form.weekday.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.start_time.id_for_label }}" class="required">{{ form.start_time.label }}</label>
        {{ form.start_time }}
        {% if form.start_time.errors %}
          <ul class="errorlist">
            {% for error in form.start_time.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.end_time.id_for_label }}" class="required">{{ form.end_time.label }}</label>
        {{ form.end_time }}
        {% if form.end_time.errors %}
          <ul class="errorlist">
            {% for error in form.end_time.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    </div>

    <!-- üëá Í∞ïÏùò Í∏∞Í∞Ñ (ÌïÑÏàò) -->
    <div class="form-row-2">
      <div class="form-group">
        <label for="{{ form.start_date.id_for_label }}" class="required">{{ form.start_date.label }}</label>
        {{ form.start_date }}
        {% if form.start_date.errors %}
          <ul class="errorlist">
            {% for error in form.start_date.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>

      <div class="form-group">
        <label for="{{ form.end_date.id_for_label }}" class="required">{{ form.end_date.label }}</label>
        {{ form.end_date }}
        {% if form.end_date.errors %}
          <ul class="errorlist">
            {% for error in form.end_date.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    </div>

    <button type="submit" class="btn-submit">
      {% if form.instance.pk %}ÏàòÏ†ïÌïòÍ∏∞{% else %}Îì±Î°ùÌïòÍ∏∞{% endif %}
    </button>

    <a href="{% url 'course:course_list' %}" class="btn-cancel">Ï∑®ÏÜå</a>
  </form>
</div>

<script>
// Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
document.getElementById('id_image').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('preview').src = e.target.result;
      document.getElementById('newImagePreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
});
</script>
{% endblock %}
