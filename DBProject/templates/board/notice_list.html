{% extends "base.html" %}
{% load static %}

{% block title %}ê³µì§€ì‚¬í•­ | DORO LMS{% endblock %}

{% block extra_css %}
<style>
  .notice-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }

  .notice-table thead tr {
    background-color: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
  }

  .notice-table th {
    padding: 12px;
    text-align: center;
    font-weight: 600;
    color: #495057;
  }

  .notice-table td {
    padding: 12px;
    border-bottom: 1px solid #dee2e6;
  }

  .notice-table tbody tr:hover {
    background-color: #f8f9fa;
  }

  .notice-title {
    text-decoration: none;
    color: #212529;
    font-weight: 500;
  }

  .notice-title:hover {
    color: #0d6efd;
  }

  .pin-badge {
    color: #dc3545;
    font-weight: bold;
    margin-right: 5px;
  }

  .btn-write {
    display: inline-block;
    padding: 10px 20px;
    background-color: #0d6efd;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: 500;
  }

  .btn-write:hover {
    background-color: #0b5ed7;
  }

  .debug-box {
    background: #fff3cd;
    border: 2px solid #ffc107;
    padding: 15px;
    margin: 20px 0;
    border-radius: 5px;
  }

  .debug-box h3 {
    margin-top: 0;
    color: #856404;
  }

  .debug-box p {
    margin: 5px 0;
    font-family: monospace;
  }
</style>
{% endblock %}

{% block content %}

<!-- ğŸ‘‡ [ë””ë²„ê¹…] ì‚­ì œí•˜ì§€ ë§ˆì„¸ìš”! -->
<div class="debug-box">
  <h3>ğŸ” ë””ë²„ê¹… ì •ë³´</h3>
  <p><strong>ë¡œê·¸ì¸ ì—¬ë¶€:</strong> {{ request.user.is_authenticated }}</p>
  {% if request.user.is_authenticated %}
  <p><strong>ì‚¬ìš©ì ì´ë¦„:</strong> {{ request.user.name }}</p>
  <p><strong>ì‚¬ìš©ì ì´ë©”ì¼:</strong> {{ request.user.email }}</p>
  <p><strong>ì‚¬ìš©ì role:</strong> {{ request.user.role }}</p>
  <p><strong>ë²„íŠ¼ í‘œì‹œ ì¡°ê±´:</strong>
    {% if request.user.role == "instructor" or request.user.role == "manager" %}
      <span style="color: green; font-weight: bold;">âœ… ì¶©ì¡±</span>
    {% else %}
      <span style="color: red; font-weight: bold;">âŒ ë¶ˆì¶©ì¡± (role: {{ request.user.role }})</span>
    {% endif %}
  </p>
  {% else %}
  <p style="color: red;"><strong>ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ</strong></p>
  {% endif %}
</div>

<section class="hero">
  <div class="hero-inner">
    <h1 class="hero-title">ê³µì§€ì‚¬í•­</h1>
  </div>
</section>

<main class="card-wrap">
  <div class="card-inner">

    <!-- ğŸ‘‡ ê³µì§€ì‚¬í•­ ì‘ì„± ë²„íŠ¼ (ê°•ì‚¬/ê´€ë¦¬ìë§Œ) -->
    {% if request.user.is_authenticated %}
      {% if request.user.role == "instructor" or request.user.role == "manager" %}
      <div style="text-align: right; margin-bottom: 20px;">
        <a href="{% url 'user:notice_create' %}" class="btn-write">
          âœï¸ ê³µì§€ì‚¬í•­ ì‘ì„±
        </a>
      </div>
      {% endif %}
    {% endif %}

    <!-- ğŸ‘‡ ê³µì§€ì‚¬í•­ ëª©ë¡ í…Œì´ë¸” -->
    <table class="notice-table">
      <thead>
        <tr>
          <th style="width: 80px;">ë²ˆí˜¸</th>
          <th style="text-align: left;">ì œëª©</th>
          <th style="width: 120px;">ì‘ì„±ì</th>
          <th style="width: 120px;">ì‘ì„±ì¼</th>
          <th style="width: 80px;">ì¡°íšŒìˆ˜</th>
        </tr>
      </thead>
      <tbody>
        {% for notice in notices %}
        <tr>
          <td style="text-align: center;">
            {% if notice.is_pinned %}
              <span class="pin-badge">ğŸ“Œ</span>
            {% else %}
              {{ forloop.counter }}
            {% endif %}
          </td>
          <td>
            <a href="{% url 'user:notice_detail' notice.notice_id %}" class="notice-title">
              {% if notice.is_pinned %}
                <span class="pin-badge">[ê³µì§€]</span>
              {% endif %}
              {{ notice.title }}
            </a>
          </td>
          <td style="text-align: center;">{{ notice.author.name }}</td>
          <td style="text-align: center;">{{ notice.created_at|date:"Y-m-d" }}</td>
          <td style="text-align: center;">{{ notice.views }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" style="padding: 50px; text-align: center; color: #6c757d;">
            <p style="font-size: 18px; margin-bottom: 10px;">ğŸ“‹</p>
            <p>ë“±ë¡ëœ ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% if request.user.is_authenticated %}
              {% if request.user.role == "instructor" or request.user.role == "manager" %}
              <p style="margin-top: 15px;">
                <a href="{% url 'user:notice_create' %}" class="btn-write">ì²« ê³µì§€ì‚¬í•­ ì‘ì„±í•˜ê¸°</a>
              </p>
              {% endif %}
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>
</main>

{% endblock %}
